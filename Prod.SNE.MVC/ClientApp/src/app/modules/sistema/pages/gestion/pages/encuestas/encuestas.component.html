<ngx-spinner bdColor="rgba(51,51,51,0.8)" size="medium" color="#fff" type="ball-scale-multiple">
<p style="font-size: 20px; color: white">Procesando información, por favor no cierre la ventana.</p>
</ngx-spinner>
<br>
<h1 class="title-custom">Encuestas</h1>
<hr class="mt-0">
<ng-container >
    <form  >
        <div class="panel panel-default panel-custom">
            <div class="panel-heading">Buscar registros</div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="">Título:</label>
                            <div>
                                <input type="text" [formControl]="formMACRO.Titulo" class="form-control" placeholder="Título de encuesta">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4"></div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="">Estado:</label>
                            <div>
                                <nz-select nzAllowClear nzShowSearch nzPlaceHolder="--Todos--"
                                [formControl]="formMACRO.Estado">
                                    <ng-container *ngFor="let item of array_estado">
                                        <nz-option [nzValue]="item.id_enumerado" [nzLabel]="item.nombre"></nz-option>
                                    </ng-container>
                                </nz-select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="">Fecha de inicio de vigencia:</label>
                            <div>
                                <nz-date-picker 
                                    [formControl]="formMACRO.FechaInicio" 
                                    nzFormat="dd/MM/yyyy">
                                </nz-date-picker>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4"></div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="">Fecha de fin de vigencia:</label>
                            <div>
                                <nz-date-picker
                                    [formControl]="formMACRO.FechaFin" 
                                    [(ngModel)]="form.fecha_fin"
                                    nzFormat="dd/MM/yyyy">
                                </nz-date-picker>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-footer text-center">
                <button type="button" class="btn btn-default-custom" (click)="clean_all()"><i class="fa fa-eraser"
                    aria-hidden="true"></i> Limpiar</button>
                &nbsp;&nbsp;
                <button type="button" class="btn btn-primary-custom" (click)="get_list()"><i class="fa fa-search"></i> Buscar</button>
            </div>
        </div>
        
    </form>
</ng-container>
<ng-container>
    <div class="row">
        <div class="col-sm-12 text-right">
            <div class="form-group" style="margin-top: -15px;">
                <!--
                <button type="button" class="btn btn-default-custom" style="margin-bottom: 4px;" 
                    title="Generar Reporte">
                    <i class="fa fa-file-excel-o"></i> </button>&nbsp;&nbsp;-->
                <button class="btn btn-primary-custom pull-right" [routerLink]="['/sistema/gestion/gestor-encuestas/add']">
                    <i class="fa fa-plus-circle"></i> Crear encuesta
                </button>
            </div>
        </div>
    </div>
</ng-container>
<ng-container> 
    <div class="table-responsive table-striped table-bordered table-hover">
        <nz-table #ajaxTable class="container-table-custom" nzShowSizeChanger [nzFrontPagination]="false"
        [nzBordered]="true" [nzData]="EncuestaList" [nzLoading]="cargando_tabla" [nzTotal]="total"
        [(nzPageIndex)]="pageIndex" [(nzPageSize)]="pageSize" (nzPageIndexChange)="handleClickBuscar()"
        (nzPageSizeChange)="handleClickBuscar(true)">

            <thead>
                <tr>
                    <th>N°</th>
                    <th WIDTH="500">Título</th>
                    <th>¿Es anónima?</th>
                    <th>N° de encuestados</th>
                    <th>Fecha de vigencia</th>
                    <th>Estado</th>
                    <th WIDTH="100">Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let item of ajaxTable.data; let i = index">
                    <td align="center">{{ (pageSize * (pageIndex - 1)) + (i + 1) }}</td>
                    <td>{{ item.titulo}}</td>
                    <td align="center">{{ item.es_anonimo?'SI':'NO'}}</td>
                    <td align="center">{{ item.total_encuestados }}</td>     
                    <td align="center">Desde: {{ item.fecha_inicio | date: 'dd/MM/yyyy hh:mm a'}} <br>Hasta: {{ item.fecha_fin | date: 'dd/MM/yyyy hh:mm a'}}</td>     
                    <td align="center">{{ item.estado_name }}</td>              
                    <td align="center" >
                        <ng-container  *ngIf="item.es_eliminado==false 
                            && (item.id_estado == _ESTADO_ENCUESTA_ENUMERADO.registrado || item.id_estado == _ESTADO_ENCUESTA_ENUMERADO.pre_publicado)">
                            <a class="btn btn-icon"  data-tooltip="tooltip" data-placement="bottom" 
                            [routerLink]="['/sistema/gestion/gestor-encuestas/edit',item.id_encuesta]"
                            title="Editar encuesta" >
                                <i class="fa fa-edit" aria-hidden="true"></i>
                            </a>
                        </ng-container>  
                        <ng-container  *ngIf="show_super_edit">
                            <a class="btn btn-icon"  data-tooltip="tooltip" data-placement="bottom" 
                            [routerLink]="['/sistema/gestion/gestor-encuestas/reedit',item.id_encuesta]"
                            title="Editar encuesta" >
                                <i class="fa fa-retweet" aria-hidden="true"></i>
                            </a>
                        </ng-container>  
                            
                        <ng-container *ngIf="item.id_estado == _ESTADO_ENCUESTA_ENUMERADO.publicado 
                                            || item.id_estado == _ESTADO_ENCUESTA_ENUMERADO.eliminado 
                                            || item.id_estado == _ESTADO_ENCUESTA_ENUMERADO.procesado">
                            <a class="btn btn-icon"  data-tooltip="tooltip" 
                            [routerLink]="['/sistema/gestion/gestor-encuestas/view',item.id_encuesta]"
                            data-placement="bottom" title="Ver encuesta" >
                                <i class="fa fa-eye" aria-hidden="true"></i>
                            </a>
                        </ng-container>

                        <ng-container *ngIf="item.id_estado == _ESTADO_ENCUESTA_ENUMERADO.publicado">
                            <a class="btn btn-icon"  data-tooltip="tooltip" 
                            (click)="_prepublicar_encuesta(item.id_encuesta,item.titulo)"
                            data-placement="bottom" title="Regresar a elaboración" >
                                <i class="fa fa-backward" aria-hidden="true"></i>
                            </a>
                        </ng-container>

                        <ng-container *ngIf="item.es_eliminado==false && item.id_estado == _ESTADO_ENCUESTA_ENUMERADO.registrado">
                            <a  class="btn btn-icon" data-tooltip="tooltip" data-placement="bottom" (click)="_delete_encuesta(item.id_encuesta,item.titulo)" title="Eliminar encuesta" >
                                <i class="fa fa-trash" aria-hidden="true"></i>
                            </a>
                        </ng-container>

                        <ng-container *ngIf="item.show_extra_options && (item.id_estado == _ESTADO_ENCUESTA_ENUMERADO.publicado 
                                            || item.id_estado == _ESTADO_ENCUESTA_ENUMERADO.procesado)">
                            <a class="btn btn-icon"  data-tooltip="tooltip" 
                            (click)="descargar_data_encuesta(item.id_encuesta)"
                            data-placement="bottom" title="Descargar data de encuesta" >
                                <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                            </a>
                        </ng-container>
                        <!--item.show_extra_options && (item.id_estado == _ESTADO_ENCUESTA_ENUMERADO.publicado)-->
                        <ng-container *ngIf="false">
                            <a class="btn btn-icon"  data-tooltip="tooltip" 
                            (click)="_show_resultados_upload(item)"
                            data-placement="bottom" title="Subir resultados de analizada" >
                                <i class="fa fa-cloud-upload" aria-hidden="true"></i>
                            </a>
                        </ng-container>

                        <ng-container *ngIf="item.show_extra_options && item.id_estado == _ESTADO_ENCUESTA_ENUMERADO.procesado">
                            <a class="btn btn-icon"  data-tooltip="tooltip" 
                            [routerLink]="['/sistema/gestion/gestor-encuestas/results',item.id_encuesta]"
                            data-placement="bottom" title="Ver encuesta en cifras" >
                                <i class="fa fa-picture-o" aria-hidden="true"></i>
                            </a>
                        </ng-container>
                    </td>
                </tr>
            </tbody>
        </nz-table>
    </div>
</ng-container>

<ng-container *ngIf="modal_subir_resultados">
    <app-subir-resultados 
    [visible]="modal_subir_resultados"
    [selected_encuesta]="selected_encuesta"
    (onCloseSaveModalResultados)="handleOnCloseSaveModalResultados($event)"
    (onCloseModalResultados)="handleOnCloseModalResultados($event)"></app-subir-resultados>
</ng-container>
